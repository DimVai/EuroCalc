<!DOCTYPE html>
<html lang="gr" style="color-scheme:dark;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Euro</title>

    <link href="favicon.ico" rel="shortcut icon">

    <!-- <link rel="stylesheet" href="https://dimvai.github.io/Dim-Plus/dim-boilerplate.css"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://dimvai.github.io/Dim-Plus/Q.js"></script>


    <style>
        .btn{
            min-width: 5ch;
        }
    </style>
        
</head>
<body data-bs-theme="dark" class="p-4">

    <header>
        <h1 class="text-center">Euro Calculator</h1>
    </header>


    <main x-data>

        <div class="my-4">
            <label for="expression" class="form-label" >Expression</label>
            <input type="text" class="form-control fs-1" id="expression" inputmode="numeric">
            
            <div class="d-flex justify-content-between my-3">
                <button class="btn btn-primary btn-insert">+</button>
                <button class="btn btn-success btn-insert">€</button>
                <button class="btn btn-secondary btn-insert">$</button>
                <button class="btn btn-info btn-insert">£</button>
                <button class="btn btn-danger btn-clear">⍉</button>

            </div>
        </div>
        <div class="my-4">
            <label for="result" class="form-label">Result</label>
            <h2 id="result" class="fs-1">0 €</h2>
        </div>



    </main>

    <footer>

    </footer>



    <script>

        let fx = {
            EUREUR: 1,
            USDEUR: 0.97,
            GBPEUR: 1.21,
        };

        function sanitize(expression) {
            // Μετατρέπει τα κόμματα σε τελείες
            expression = expression.replace(/,/g, ".");
            // Αφαιρεί όλα τα χαρακτήρες εκτός από αριθμούς, τελείες και νομίσματα
            expression = expression.replace(/[^0-9.€$£+]/g, "");     // Στο μέλλον: [^0-9.€$£+-/*]
            return expression;
        }

        function euroSum(expression) {
            
            function convertToEuro(value) {
                let amount = parseFloat(value.replace(/[^0-9.]/g, ""));
                if (value.includes("€")) return amount * fx.EUREUR;
                if (value.includes("$")) return amount * fx.USDEUR;
                if (value.includes("£")) return amount * fx.GBPEUR;
                return 0; // Αν δεν αναγνωριστεί νόμισμα
            }

            const amounts = expression.match(/(?:[€$£]?\d+\.\d+[€$£]?|[€$£]?\d+[€$£]?)/g) || [];
            // console.log(amounts);
    
            const convertedAmounts = amounts.map(convertToEuro);
            // console.log(convertedAmounts);
            const totalSum = Q.sum(convertedAmounts);
            return totalSum;

        }

        function focusInput() {
            Q("#expression").element.focus();
        }
        focusInput();

        function calculator() {
            let expression = Q("#expression").value;
            expression = sanitize(expression);
            Q("#expression").value = expression;
            Q("#result").set( euroSum(expression).toFixed(2) + " €" );
            focusInput();
        }

        Q("#expression").on("input", calculator);

        Q(".btn-insert").on("click", function() {
            Q("#expression").value += this.innerText;
            calculator();
        });

        Q(".btn-clear").on("click", function() {
            Q("#expression").value = "";
            calculator();
        });


    </script>
    
</body>
</html>